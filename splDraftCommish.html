<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>No Consolation</title>
  <link rel="stylesheet" href="stylesspl.css" />
  <link
    rel="stylesheet"
    href="https://use.fontawesome.com/releases/v5.14.0/css/all.css"
    crossorigin="anonymous"
  />
  <link
    href="https://fonts.googleapis.com/css2?family=Kumbh+Sans:wght@400;700&display=swap"
    rel="stylesheet"
  />
  <style>
    /* Reset and body */
    body {
      font-family: 'Kumbh Sans', sans-serif;
      color: #a5a5a5;
      margin: 0;
      padding: 0 20px 40px;
    }

    /* Navbar and sub-navbar (assumed from your stylesheet, minimal override here) */
    .navbar, .sub-navbar {
      margin-bottom: 20px;
    }




    /* Form label and selects */
    label {
      font-weight: 600;
      margin-right: 8px;
    }
    select {
      width: 180px;  /* fixed width so it doesn't shrink */
      min-width: 180px;
      padding: 6px 10px;
      font-size: 1rem;
      border: 1px solid #ccc;
      border-radius: 6px;
      cursor: pointer;
      transition: border-color 0.2s ease;
    }

    select:focus {
      border-color: white;
      outline: none;
      box-shadow: 0 0 5px white;
    }


    /* Layout form */
    .form-row {
      margin: 0 auto 24px;
      max-width: 400px;
      display: flex;
      flex-wrap: wrap;
      gap: 10px 12px;
      align-items: left;
      justify-content: space-between;
    }

    .form-row label {
      flex: 0 0 auto;
    }
    .form-row select {
      flex: 1 1 auto;
      min-width: 120px;
    }
.dashboard-header {
  display: flex;
  justify-content: flex-end;
  margin: 20px;
}

#dashboardDropdown {
  padding: 6px 12px;
  font-size: 1rem;
  border-radius: 6px;
  border: 1px solid #000;
  color: #fff;
  cursor: pointer;
  transition: background 0.3s;
}

/* default background */
#dashboardDropdown.default {
  background-color: #7f8c8d; /* grey for unselected */
}

#draftedRostersContainer {
  max-width: 1240px;
  margin: 20px auto;
  padding: 0 20px;
}

.drafted-rosters-table {
  width: 100%;
  table-layout: fixed; /* evenly spaced columns */
  border-collapse: collapse; /* needed for vertical borders */
  border-radius: 10px;
  overflow: hidden;
  background-color: #fff;
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

.drafted-rosters-table th,
.drafted-rosters-table td {
  padding: 4px 8px; /* more space vertically and horizontally */
  text-align: center;
  border-bottom: 1px solid #ccc; /* horizontal row separation */
  border-right: 1px solid #ccc;  /* vertical column separation */
  height: 30px; /* fixed row height for even spacing */
  box-sizing: border-box;
}

.drafted-rosters-table th:last-child,
.drafted-rosters-table td:last-child {
  border-right: none; /* remove border on last column */
}
.drafted-rosters-table tbody tr:nth-child(3) td {
  border-top: 3px solid #ccc; /* thicker border between captains and sidekicks */
}

.drafted-rosters-table th {
  font-weight: 600;
  font-size: .8rem;
  color: #fff;
}

.drafted-rosters-table td {
  font-weight: 500;
  color: #333;
}


/* Rounded corners for top and bottom row */
.drafted-rosters-table thead th:first-child {
  border-top-left-radius: 10px;
}
.drafted-rosters-table thead th:last-child {
  border-top-right-radius: 10px;
}
.drafted-rosters-table tbody tr:last-child td:first-child {
  border-bottom-left-radius: 10px;
}
.drafted-rosters-table tbody tr:last-child td:last-child {
  border-bottom-right-radius: 10px;
}


  </style>
</head>
<body>

  <!-- Navbar Section -->
  <nav class="navbar">
    <div class="navbar__container">
      <a href="/" id="navbar__logo"><i class="fas fa-gem"></i>NC</a>
      <div class="navbar__toggle" id="mobile-menu">
        <span class="bar"></span> <span class="bar"></span> <span class="bar"></span>
      </div>
      <ul class="navbar__menu">
        <li class="navbar__item"><a href="/" class="navbar__links">Home</a></li>
        <li class="navbar__item"><a href="/streaming.html" class="navbar__links">Streaming</a></li>
        <li class="navbar__item"><a href="/podcasts.html" class="navbar__links">Podcasts</a></li>
        <li class="navbar__item"><a href="/roster.html" class="navbar__links">Info</a></li>
        <li class="navbar__item"><a href="/spl.html" class="navbar__links">SPL</a></li>
        <li class="navbar__btn">
          <a href="https://discord.gg/dzEZA3Jwm5" target="_blank" class="button">Get Notified</a>
        </li>
      </ul>
    </div>
  </nav>

  <!-- Secondary Nav Bar -->
  <nav class="sub-navbar">
    <ul class="sub-navbar__menu">
      <li><a href="/spl.html">SPL Home</a></li>
      <li><a href="/spl-stats.html">Stats</a></li>
      <li><a href="/spl-rosters.html">Rosters</a></li>
      <li><a href="/splszn2.html">Season 2</a></li>
    </ul>
  </nav>

<!-- Dashboard Dropdown -->
<div class="dashboard-header">
  <div id="dashboardDropdownContainer">
    <select id="dashboardDropdown">
      <option value="">--</option>
      <option value="SPL">SPL</option>
      <option value="MLS">MLS</option>
    </select>
  </div>
</div>

<!-- Selected player card -->
<div id="showSelectedPlayer" class="player-card" style="display:none;"></div>

<div id="draftedRostersContainer"></div>



<!-- Dashboard container: three columns -->
<div class="dashboard-container">

  <!-- Column 1: Player list -->
  <div id="playerListContainer">
    <table id="playerTable">
      <thead>
        <tr><th>Players</th></tr>
      </thead>
      <tbody id="playerList"></tbody>
    </table>
  </div>

  <!-- Column 2: Budget + Save/Clear button -->
  <div class="budget-column">
    <table id="budgetTable">
      <thead>
        <tr>
          <th>Coach</th>
          <th>Budget</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
    <button id="saveClearBtn" class="submit-btn">Save and Clear</button>
  </div>

  <!-- Column 3: Live bids + bid input -->
  <div class="bids-column">
    <div id="commishBoard" class="dashboard" style="min-height: 50px;"></div>
    </div>
  </div>

</div>


<style>
    .right-dashboard {
  display: flex;
  flex-direction: column;
  gap: 10px;
}

.dashboard-container {
  display: flex;
  gap: 20px;
  align-items: flex-start;
  max-width: 1200px;
  margin: 40px auto;
}
#budgetTable {
  flex: 0 0 300px; /* fixed width */
}

#commishBoard {
  flex: 1 1 auto; /* fill remaining space */
}
.dashboard {
  max-width: 500px;
  margin: 40px auto;
  display: flex;
  flex-direction: column;
  gap: 12px;
  position: relative;
}

.submission-bubble {
  background-color: #c0392b;
  color: #fff;
  padding: 12px 20px;
  border-radius: 20px;
  font-weight: bold;
  font-size: 1.2rem;
  border: 2px solid #000;
  transition: transform 0.4s ease;
  opacity: 1;
  width: 400px;
}

.new-bubble {
  transform: translateX(50%) scale(0.9); /* start slightly right and smaller */
  opacity: 0;
  animation: slideFadeScale 0.5s cubic-bezier(0.4, 0, 0.2, 1) forwards;
}

@keyframes slideFadeScale {
  to {
    transform: translateX(0) scale(1); /* final position and normal size */
    opacity: 1;
  }
}


.submit-btn {
  display: block;
  margin: 20px auto;
  padding: 15px;
  font-size: 1.2rem;
  border-radius: 10px;
  border: 2px solid #000;
  cursor: pointer;
  background: linear-gradient(135deg, #c0392b, #e74c3c);
  color: #fff;
  transition: transform 0.2s, box-shadow 0.2s, background 0.3s;
}

.submit-btn:hover {
  transform: scale(1.05);
  box-shadow: 0 6px 15px rgba(0,0,0,0.3);
  background: linear-gradient(135deg, #e74c3c, #c0392b);
}

#budgetTable {
  width: 300px;
  border-collapse: collapse;
  margin: 0;
  background-color: #f0f0f0; /* light grey table background */
  color: #333;
  font-size: 1rem;
  border-radius: 10px;
  overflow: hidden;
  box-shadow: 0 2px 8px rgba(0,0,0,0.15);
}

#budgetTable th, #budgetTable td {
  padding: 10px 15px;
  text-align: left;
}

#budgetTable thead th {
  background-color: #7f8c8d; /* default dropdown grey */
  color: #fff;
  font-weight: 600;
  border-bottom: 2px solid #555;
}

#budgetTable tbody tr {
  background-color: #f0f0f0;
  border-bottom: 1px solid #ccc;
}


#budgetTable th:nth-child(1),
#budgetTable td:nth-child(1) {
  width: 50%;
}

#budgetTable th:nth-child(2),
#budgetTable td:nth-child(2) {
  width: 50%;
  text-align: center; /* optional for budget values */
}

@keyframes budgetUpdate {
  0% { background-color: #0c7925; }  /* light green start */
  100% { background-color: #f0f0f0; }   /* normal table row background */
}

.highlight-row {
  animation: budgetUpdate 4s ease forwards;
}
#playerTable {
  width: 100%;
  border-collapse: collapse;
  background: #f0f0f0; /* dark background to match site */
  color: #333;
  border: 1px solid #444;
  border-radius: 8px;
  overflow: hidden;
}

#playerTable th {
  background: var(--header-color, #c00); /* will match dropdown color */
  color: white;
  text-align: left;
  padding: 10px;
}

#playerTable td {
  border-bottom: 1px solid #444;
  padding: 5px;
}
/* highlight style for selected player */
#playerTable tbody tr.selected {
  background: linear-gradient(135deg, #50a5d5, #8e44ad);
  color: #fff;
  font-weight: bold;
}
#playerTable tbody tr {
  cursor: pointer;
  transition: background 0.2s;
}
#playerTable tbody tr:hover {
  background: #eee;
}
.player-card {
  max-width: 1000px;
  margin: 20px auto;
  padding: 15px 20px;
  background: #1a1a1a;
  border-radius: 12px;
  border: 2px solid #e74c3c;
  color: black;
  font-family: 'Kumbh Sans', sans-serif;
  box-shadow: 0 4px 12px rgba(0,0,0,0.3);
}
.player-card h2 {
  margin: 0 0 10px;
  font-size: 1.6rem;
  color: #e74c3c;
  text-align: center;
}
.player-stats {
  display: grid;
  grid-template-columns: repeat(7, 1fr);
  gap: 8px;
  text-align: center;
}
.player-stats div {
  background: #f0f0f0;
  padding: 8px;
  border-radius: 6px;
  font-size: 0.9rem;
}
/* Player list column */
#playerListContainer {
  flex: 0 0 250px;
  max-height: 600px;
  overflow-y: auto;
}

/* Column 2: Budget + button */
.budget-column {
  flex: 0 0 300px;
  display: flex;
  flex-direction: column;
  gap: 10px;
}

/* Column 3: Bids + input */
.bids-column {
  flex: 1;
  display: flex;
  flex-direction: column;
  gap: 10px;
}

/* Budget table */
#budgetTable {
  width: 100%;
  border-collapse: collapse;
}

#budgetTable th, #budgetTable td {
  padding: 10px 15px;
  text-align: left;
}

/* Live bid feed */


/* Save & Clear button */
#saveClearBtn {
  padding: 12px;
  width: 400px;
  font-size: 1.1rem;
  font-weight: bold;
  cursor: pointer;
  border: none;
  border-radius: 8px;
  background: linear-gradient(135deg, #8e44ad, #50a5d5);
  color: white;
  transition: transform 0.2s, box-shadow 0.2s;
}

#saveClearBtn:hover {
  transform: scale(1.05);
  box-shadow: 0 6px 15px rgba(0,0,0,0.3);
}
</style>

<script>
const feed = document.getElementById("commishBoard");
const dropdown = document.getElementById("dashboardDropdown");

const optionColors = {
  "SPL": "orangered",
  "MLS": "teal"
};

// Existing submissions & budgets
let submissions = JSON.parse(localStorage.getItem("submissions") || "{}");
let budgets = JSON.parse(localStorage.getItem("budgets") || "{}");
let draftedPlayers = JSON.parse(localStorage.getItem("draftedPlayers") || "{}");


// Initialize budgets if empty
if (Object.keys(budgets).length === 0) {
  budgets = {
    "Adam": 1000, "Austin": 1000, "Colin": 1000,
    "Danny": 1000, "Dave": 1000, "Eric": 1000,
    "Freddy": 1000, "Garrett": 1000, "Hamilton": 1000,
    "Jaco": 1000, "Jake": 1000, "Reid": 1000
  };
  localStorage.setItem("budgets", JSON.stringify(budgets));
}

const coachGroups = {
  "SPL": ["Adam", "Austin", "Danny", "Eric","Freddy","Jaco"],
  "MLS": ["Colin","Dave", "Garrett", "Hamilton", "Jake", "Reid"]
};

// Track currently selected group
let currentGroup = localStorage.getItem("dashboardOption") || "";
let lastUpdatedCoach = null;

// Render budget table
function renderBudgets(group = "") {
  const tbody = document.querySelector("#budgetTable tbody");
  tbody.innerHTML = "";
  const coachesToShow = group ? coachGroups[group] : Object.keys(budgets);

  coachesToShow.forEach(coach => {
    if (!(coach in budgets)) return;
    const tr = document.createElement("tr");
    tr.innerHTML = `<td>${coach}</td><td>$${budgets[coach]}</td>`;

    // Highlight row if budget updated
    if (lastUpdatedCoach === coach) {
      tr.classList.add("highlight-row");
      lastUpdatedCoach = null; // reset after animation
    }

    tbody.appendChild(tr);
  });

  updateTableHeaderColor(group);
}

// Render submission bubbles
function renderSubmissions(group = "") {
  feed.innerHTML = "";
  const coachesToShow = group ? coachGroups[group] : Object.keys(budgets);
  const sorted = Object.values(submissions)
                       .filter(sub => coachesToShow.includes(sub.coach))
                       .sort((a,b) => b.bid - a.bid);

  sorted.forEach(sub => {
    const div = document.createElement("div");
    div.className = "submission-bubble";
    div.textContent = `${sub.coach} - $${sub.bid}`;
    feed.appendChild(div);
  });
}

// Insert new submission dynamically (with animation)
function insertSubmission(sub) {
  const bubbles = Array.from(feed.children);
  const newBubble = document.createElement("div");
  newBubble.className = "submission-bubble new-bubble";
  newBubble.textContent = `${sub.coach} - $${sub.bid}`;

  // Insert in order by bid
  let inserted = false;
  for (let i = 0; i < bubbles.length; i++) {
    const existingBid = parseInt(bubbles[i].textContent.split('$')[1], 10);
    if (sub.bid > existingBid) {
      feed.insertBefore(newBubble, bubbles[i]);
      inserted = true;
      break;
    }
  }
  if (!inserted) feed.appendChild(newBubble);

  setTimeout(() => newBubble.classList.remove('new-bubble'), 400);
}

// Update table header color to match dropdown
function updateTableHeaderColor(group = "") {
  const color = group && optionColors[group] ? optionColors[group] : "#7f8c8d";

  // budget table headers
  document.querySelectorAll("#budgetTable thead th")
    .forEach(th => th.style.backgroundColor = color);

  // player table headers (if you added a #playerTable)
  document.querySelectorAll("#playerTable thead th")
    .forEach(th => th.style.backgroundColor = color);

  // optionally update the dashboard dropdown background to match
  const dd = document.getElementById("dashboardDropdown");
  if (dd) dd.style.backgroundColor = color;

  // set CSS var so any CSS using var(--header-color) stays in sync
  document.documentElement.style.setProperty('--header-color', color);
}

// --- make sure this gets called on initial render and when league changes ---

// on initial render (replace your existing place where you render tables)
renderBudgets(currentGroup);
renderSubmissions(currentGroup);
updateTableHeaderColor(currentGroup);

// Dropdown change listener
dropdown.addEventListener("change", () => {
  currentGroup = dropdown.value;
  if (currentGroup) {
    dropdown.style.backgroundColor = optionColors[currentGroup];
    dropdown.classList.remove("default");
    localStorage.setItem("dashboardOption", currentGroup);
  } else {
    dropdown.style.backgroundColor = "#7f8c8d";
    dropdown.classList.add("default");
    localStorage.removeItem("dashboardOption");
  }

  renderBudgets(currentGroup);
  renderSubmissions(currentGroup);
  updateTableHeaderColor(currentGroup); 
});

// Save & Clear button
document.getElementById("saveClearBtn").addEventListener("click", () => {
  if (!submissions || Object.keys(submissions).length === 0) return;

  const allowedCoaches = currentGroup ? coachGroups[currentGroup] : Object.keys(budgets);

  // Find highest bidder
  let winner = null;
  let highestBid = -1;
  Object.values(submissions).forEach(sub => {
    if (!allowedCoaches.includes(sub.coach)) return;
    if (sub.bid > highestBid) {
      highestBid = sub.bid;
      winner = sub.coach;
    }
  });

  if (winner) {
    budgets[winner] = Math.max(0, (budgets[winner] || 0) - highestBid);
    lastUpdatedCoach = winner;
    localStorage.setItem("budgets", JSON.stringify(budgets));
  }

  // --- Clear bids immediately ---
  const league = currentGroup;
  const player = JSON.parse(localStorage.getItem("nextAuctionPlayer"));
  const bidsArray = Object.values(submissions).map(sub => ({ coach: sub.coach, bid: sub.bid }));

  // --- Then send to Google Sheet ---
  fetch("https://script.google.com/macros/s/AKfycbyV2iV-RzfthJ9TnqpDKwEbQaQciQ2MbWaRyC-vABv0gFSrwN1JtGo-2lljuOz0Zsx9fw/exec", {
    method: "POST",
    body: JSON.stringify({ league, player, bids: bidsArray })
  })
  .then(res => res.json())
  .then(data => console.log("Saved to Google Sheet:", data))
  .catch(err => console.error("Error saving to sheet:", err));

  // --- Add winning player to draftedPlayers ---
if (winner && selectedPlayer) {
  draftedPlayers[winner] = draftedPlayers[winner] || [];
  draftedPlayers[winner].push({
    name: selectedPlayer.name,
    category: selectedPlayer.category
  });
  localStorage.setItem("draftedPlayers", JSON.stringify(draftedPlayers));
}

renderDraftedRostersTable(currentGroup);


    submissions = {};
  localStorage.removeItem("submissions");
  localStorage.removeItem("lastSubmission");
  renderSubmissions(currentGroup);
  renderBudgets(currentGroup);

  // Remove player if any
  if (player) {
    currentPlayers = currentPlayers.filter(p => p.name !== player.name);
    localStorage.setItem("currentPlayers", JSON.stringify(currentPlayers));
    renderPlayers(currentPlayers);
    showPlayerCard(null);
    localStorage.removeItem("selectedPlayer");
  }


});


function renderDraftedRostersTable(group = "") {
  const container = document.getElementById("draftedRostersContainer");
  if (!container) return;

  container.innerHTML = ""; // clear previous table

  const coachesToShow = group ? coachGroups[group] : Object.keys(budgets);

  // create table
  const table = document.createElement("table");
  table.className = "drafted-rosters-table";

  // header row
  const thead = document.createElement("thead");
  const headerRow = document.createElement("tr");
  coachesToShow.forEach(coach => {
    const th = document.createElement("th");
    th.textContent = coach;
    headerRow.appendChild(th);
  });
  thead.appendChild(headerRow);
  table.appendChild(thead);

  const tbody = document.createElement("tbody");

  // 7 rows total
  const numRows = 7;
  for (let i = 0; i < numRows; i++) {
    const tr = document.createElement("tr");

    coachesToShow.forEach(coach => {
      const td = document.createElement("td");
      const players = draftedPlayers[coach] || [];

      // Separate captains and sidekicks
      const captains = players.filter(p => p.category === "Captain");
      const sidekicks = players.filter(p => p.category === "Sidekick");

      let playerName = "";

      if (i < 2) playerName = captains[i] ? captains[i].name : "";
      else playerName = sidekicks[i - 2] ? sidekicks[i - 2].name : "";

      td.textContent = playerName;
      tr.appendChild(td);
    });

    tbody.appendChild(tr);
  }

  table.appendChild(tbody);
  container.appendChild(table);

  // apply header color based on league
  const color = group && optionColors[group] ? optionColors[group] : "#7f8c8d";
  table.querySelectorAll("thead th").forEach(th => th.style.backgroundColor = color);
}









// Live update across tabs
window.addEventListener("storage", e => {
  if (e.key === "lastSubmission" && e.newValue) {
    submissions = JSON.parse(localStorage.getItem("submissions") || "{}");
    const newSub = JSON.parse(e.newValue);
    const allowedCoaches = currentGroup ? coachGroups[currentGroup] : Object.keys(budgets);
    if (allowedCoaches.includes(newSub.coach)) insertSubmission(newSub);
  }
});
// Example: after Save or Clear
localStorage.setItem('budgets', JSON.stringify(budgets)); // budgets object after save/clear

// Trigger a dummy key to force other tabs to notice (optional)
localStorage.setItem('budgetUpdateSignal', Date.now());



// URLs to your published CSVs
const playerPools = {
  MLS: "https://docs.google.com/spreadsheets/d/e/2PACX-1vRqqGfFok5oirgEMcbyVwqngMWu2rsp0ZEhlj792Zlm31CBe9ECQgt5KCvcxTzO1CmyqlwHl8h_ieL3/pub?gid=627698577&single=true&output=csv",
  SPL: "https://docs.google.com/spreadsheets/d/e/2PACX-1vRqqGfFok5oirgEMcbyVwqngMWu2rsp0ZEhlj792Zlm31CBe9ECQgt5KCvcxTzO1CmyqlwHl8h_ieL3/pub?gid=1831339771&single=true&output=csv"
};

const dashboardDropdown = document.getElementById("dashboardDropdown"); // your dropdown
let currentPlayers = [];

// Load player list whenever dropdown changes
dashboardDropdown.addEventListener("change", () => {
  const league = dashboardDropdown.value;
  if (playerPools[league]) {
    loadPlayers(playerPools[league]);
    localStorage.setItem("selectedLeague", league); // remember across refreshes
  }
});

// On page load, restore last league choice
window.addEventListener("load", () => {
  fetchPlayers(); // load default league immediately
});


// Fetch players from CSV
function loadPlayers(csvUrl) {
  fetch(csvUrl)
    .then(res => res.text())
    .then(text => {
      const rows = text.trim().split("\n").map(r => r.split(","));
      currentPlayers = rows.slice(1).map(r => ({
        name: r[1],   // player name in column A
        games: r[2],
        wins: r[3],
        goals: r[4],
        msss: r[5],
        si: r[6],
        impact: r[7],
        net:r[8],
        category:r[9].trim()
      }));
      renderPlayers(currentPlayers);
    });
}

// Display players (basic example)
function renderPlayers(players) {
  const tbody = document.getElementById("playerList");
  tbody.innerHTML = "";

  players.forEach(p => {
    const row = document.createElement("tr");
    const cell = document.createElement("td");
    cell.textContent = p.name; // just the name in one column
    row.appendChild(cell);
    tbody.appendChild(row);
  });
}

let selectedPlayer = null; // holds the current auction player

// update renderPlayers so rows are clickable
function renderPlayers(players) {
  const table = document.getElementById("playerTable");
  if (!table) return;

  const tbody = table.querySelector("tbody");
  tbody.innerHTML = "";

  players.forEach(p => {
    const tr = document.createElement("tr");
    tr.innerHTML = `<td>${p.name}</td>`;
    
    // if this player is currently selected, highlight it
    if (p.name === selectedPlayer) tr.classList.add("selected");

    tr.addEventListener("click", () => {
      // update local selection
      selectedPlayer = p.name;
      localStorage.setItem("nextAuctionPlayer", selectedPlayer);

      // refresh the table to highlight correct row
      renderPlayers(players);

      // notify other pages
      localStorage.setItem("auctionUpdate", Date.now().toString());
    });

    tbody.appendChild(tr);
  });
  
}

// when page loads, restore previous selection
document.addEventListener("DOMContentLoaded", () => {
  selectedPlayer = localStorage.getItem("nextAuctionPlayer");
});

// listen for changes from other tabs/pages
window.addEventListener("storage", e => {
  if (e.key === "auctionUpdate") {
    selectedPlayer = localStorage.getItem("nextAuctionPlayer");
    renderPlayers(currentPlayers); // re-render with highlight
  }
});


// Renders the top card with player stats
function renderPlayerCard(player) {
  const card = document.getElementById("showSelectedPlayer");
  if (!player) {
    card.style.display = "none";
    return;
  }
card.style.display = "block";
card.innerHTML = `
  <h2>${player.name} - Career Stats</h2>
  <div class="player-stats">
    <div><u>Games</u></b><br>${player.games}</div>
    <div><u>Win %</u></b><br>${player.wins}</div>
    <div><u>Goal/g</u></b><br>${player.goals}</div>
    <div><u>MS-SS/g</u></b><br>${player.msss}</div>
    <div><u>SI</u></b><br>${player.si}</div>
    <div><u>Impact</u></b><br>${player.impact}</div>
    <div><u>+/-</u></b><br>${player.net}</div>
  </div>
`;

}


// Update renderPlayers to set selectedPlayer object, not just name
function renderPlayers(players) {
  const table = document.getElementById("playerTable");
  if (!table) return;

  currentPlayers = players;
  const tbody = table.querySelector("tbody");
  tbody.innerHTML = "";

  players.forEach(p => {
    const tr = document.createElement("tr");
    tr.innerHTML = `<td>${p.name}</td>`;
    if (p.name === (selectedPlayer && selectedPlayer.name)) {
      tr.classList.add("selected");
    }

    tr.addEventListener("click", () => {
    selectedPlayer = p; // store the full object, not just name
    localStorage.setItem("nextAuctionPlayer", JSON.stringify(selectedPlayer));

    renderPlayers(players);        // highlight the selected row
    renderPlayerCard(selectedPlayer); // update the top card

    // trigger storage event for other tabs
    localStorage.setItem("auctionUpdate", Date.now().toString());
    });


    tbody.appendChild(tr);
  });
}

// Restore on load
document.addEventListener("DOMContentLoaded", () => {
  const stored = localStorage.getItem("nextAuctionPlayer");
  if (stored) {
    selectedPlayer = JSON.parse(stored);
    renderPlayerCard(selectedPlayer);
  }
});


// Sync across tabs
window.addEventListener("storage", e => {
  if (e.key === "auctionUpdate") {
    const stored = localStorage.getItem("nextAuctionPlayer");
    if (stored) {
      selectedPlayer = JSON.parse(stored);
      renderPlayerCard(selectedPlayer);
      renderPlayers(currentPlayers);
    }
  }
});
// On dashboard: when a player is selected
function selectPlayer(player) {
  localStorage.setItem("selectedPlayer", JSON.stringify(player));
  showPlayerCard(player); // dashboard card
}

window.addEventListener('storage', e => {
  if (e.key === 'budgets' || e.key === 'budgetUpdateSignal') {
    budgets = JSON.parse(localStorage.getItem('budgets') || '{}');
    renderBudgets(currentGroup);
  }
});

// Initial roster render on page load
renderDraftedRostersTable(); // show all drafted players


dashboardDropdown.addEventListener("change", () => {
  currentGroup = dashboardDropdown.value;
  renderDraftedRostersTable(currentGroup); // show only selected group if desired
});

</script>





  <!-- Footer Section (unchanged) -->
  <div class="footer__container">
    <div class="footer__links">
      <div class="footer__link--wrapper">
        <div class="footer__link--items">
          <h2>About Us</h2>
          <a href="/info.html">Mission</a>
          <a href="/info.html">Vision</a>
          <a href="/info.html">Roster</a>
        </div>
        <div class="footer__link--items">
          <h2>Standings</h2>
          <a href="/info.html">Statistics</a>
        </div>
      </div>
      <div class="footer__link--wrapper">
        <div class="footer__link--items">
          <h2>Contact Us</h2>
          <a href="https://discord.gg/dzEZA3Jwm5">Discord</a>
        </div>
        <div class="footer__link--items">
          <h2>Social Media</h2>
          <a href="https://twitch.tv/noconsolation" target="_blank">Twitch</a>
          <a href="https://www.tiktok.com/@noconsolation?lang=en" target="_blank">TikTok</a>
          <a href="https://www.youtube.com/@thereisnoconsolation" target="_blank">YouTube</a>
          <a href="https://twitter.com/NoConsolation_" target="_blank">Twitter</a>
        </div>
      </div>
    </div>
    <section class="social__media">
      <div class="social__media--wrap">
        <div class="footer__logo">
          <a href="/" id="footer__logo"><i class="fas fa-gem"></i>No Consolation</a>
        </div>
        <p class="website__rights">© No Consolation 2023. All rights reserved</p>
        <div class="social__icons">
          <a class="social__icon--link" href="https://twitch.tv/noconsolation" target="_blank"><i class="fab fa-twitch"></i></a>
          <a class="social__icon--link" href="https://discord.gg/dzEZA3Jwm5" target="_blank"><i class="fab fa-discord"></i></a>
          <a class="social__icon--link" href="https://www.youtube.com/@thereisnoconsolation" target="_blank"><i class="fab fa-youtube"></i></a>
          <a class="social__icon--link" href="https://twitter.com/NoConsolation_" target="_blank"><i class="fab fa-twitter"></i></a>
          <a class="social__icon--link" href="https://www.tiktok.com/@noconsolation?lang=en" target="_blank"><i class="fab fa-tiktok"></i></a>
        </div>
      </div>
    </section>
  </div>




  <script src="app.js"></script>
</body>
</html>
